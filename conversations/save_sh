#!/bin/bash
###
FASTMODE=1
###

getname() {
	src=$(curl -Ls https://www.behindthename.com/random/random.php?gender=both&number=1&sets=1&surname=&norare=yes&all=yes)
	T1=$(echo "$src" | grep plain)
	T2="${T1%%</a>*}"
	NAME="${T2##*>}"
	echo $NAME
}

getquote() {
	one=$(curl -Ls "http://www.quotationspage.com/random.php")
	T1=$(echo "$one" | sed 's/<p>/\n/g' | grep '.html">' | cat -n | head -n 5 | tail -n 1)
	T2="${T1%%</a>*}"
	QUOTE="${T2#*.html\">}"
	echo $QUOTE
}

printmsg() {
	if [[ $FASTMODE -eq 1 ]]; then
		echo $1
		return
	fi
	for (( i=0; i<${#1}; i++ )); do
  	echo -n "${1:$i:1}"
	sleep 0.05
	done
}

rmbalise() {
	stt="."
	if [[ "$1" == *"<"* ]]; then
		BEFORE="${1%%<*}"
		AFTER="${1##*>}"
		RES="$BEFORE$AFTER"
		if [[ -z "${RES// }" ]]; then
			echo "\033[35mWhat ?\033[0m"
			stt="*"
		else
			echo $RES
		fi
	else
		echo $1
	fi
}

rep() {
	INPUT="$1"
	SUB="$2"
	if [[ "$INPUT" == *"$SUB"* ]]; then
		INPUT="\033[35m$(getquote)\033[0m"
		stt="*"
	fi
}

blacklist_string() {
	rep "$1" "I love to chat to people."
	rep "$1" "Image from www.youtube.com"
	rep "$1" "Most men are pretty rude to me."
	rep "$1" "Image from www.expedia.com"
	echo -e $INPUT
}

waiting_sc() {
	if [[ $FASTMODE -eq 1 ]]; then
		return 
	fi
	for i in {1..2}; do
		echo -n "."; sleep 0.1; echo -en "\033[2K\r"
		echo -n ".."; sleep 0.1; echo -en "\033[2K\r"
		echo -n "..."; sleep 0.1; echo -en "\033[2K\r"
		echo -n ".."; sleep 0.1; echo -en "\033[2K\r"
	done
	echo -n "."; sleep 0.1; echo -en "\033[2K\r"
}

###*
clear

stt=">"
K1_NAME=$(getname)
K2_NAME=$(getname)
FILENAME="conv-$(date +%D)-$(date +%T)-$(date +%s)"
SAVE="conversations/$FILENAME"
echo $SAVE
exit

K1_IN="$1"
if [[ -z "$K1_IN" ]]; then
	K1_IN=$(getquote)
fi
date=$(date '+%H:%M:%S %d-%m-%Y')
echo -e "$date [ $K1_NAME & $K2_NAME ] >> \033[95m$FILENAME\033[0m"; echo
echo -e "$date [ $K1_NAME & $K2_NAME ] >> $SAVE\n" >> $SAVE
date=$(date '+%H:%M:%S');
echo -en "\033[2m$date [${stt}] $K1_NAME : \033[22m"; echo -en "\033[32m"; printmsg "$K1_IN"; echo -ne "\033[0m"

while true
do
	K1P="input=${K1_IN}\
		&botkey=icH-VVd4uNBhjUid30-xM9QhnvAaVS3wVKA3L8w2mmspQ-hoUB3ZK153sEG3MX-Z8bKchASVLAo~\
		&channel=7\
		&sessionid=482851214\
		&client_name=uuiprod-un18e6d73c-user-248113&id=true"

	K1_OUT=$(curl -s -X POST -d "${K1P}" https://icap.iconiq.ai/talk)
	# echo K1_OUT; echo $K1_OUT; echo
	T1=${K1_OUT%[*}
	# echo T1; echo $T1; echo
	T2=${T1%]*}
	# echo T2; echo $T2; echo
	T3=${T2##*[}
	# echo T3; echo $T3; echo
	T4=${T3:1:-1}
	T5=$(echo $T4 | tr -d '\\' | tr -d '/' | tr -d '"' | tr -d "'")
	T6=$(rmbalise "$T5")
	K2_IN=$(blacklist_string "$T6")

	waiting_sc
	echo
	date=$(date '+%H:%M:%S');
	echo -en "\033[2m$date [${stt}] $K2_NAME : \033[22m"; echo -en "\033[34m"; printmsg "$K2_IN"; echo -ne "\033[0m"

	K2P="input=${K2_IN}\
		&botkey=icH-VVd4uNBhjUid30-xM9QhnvAaVS3wVKA3L8w2mmspQ-hoUB3ZK153sEG3MX-Z8bKchASVLAo~\
		&channel=7\
		&sessionid=482851365\
		&client_name=uuiprod-un18e6d73c-user-248152&id=true"

	K2_OUT=$(curl -s -X POST -d "${K2P}" https://icap.iconiq.ai/talk)
	# echo K2_OUT; echo $K2_OUT; echo
	T1=${K2_OUT%[*}
	# echo T1; echo $T1; echo
	T2=${T1%]*}
	# echo T2; echo $T2; echo
	T3=${T2##*[}
	# echo T3; echo $T3; echo
	T4=${T3:1:-1}
	T5=$(echo $T4 | tr -d '\\' | tr -d '/' | tr -d '"' | tr -d "'")
	T6=$(rmbalise "$T5")
	K1_IN=$(blacklist_string "$T6")

	waiting_sc
	echo
	date=$(date '+%H:%M:%S');
	echo -en "\033[2m$date [${stt}] $K1_NAME : \033[22m"; echo -en "\033[32m"; printmsg "$K1_IN"; echo -ne "\033[0m"
done
